<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8">
  <title>Panel LAN Center</title>
  <link rel="stylesheet" href="style.css">
</head>
<body>

<h1>ğŸš€ PANEL LAN CENTER JACKNNIEL</h1>

<h2 id="rolTexto"></h2>

<!-- ğŸ”¥ PANEL ADMIN -->
<div id="adminPanel" style="display:none;" class="card">
  <h2>ğŸ” Admin: Subir Links QR (Google Drive)</h2>

  <input id="linkBanco" placeholder="Pega link Banco UniÃ³n (Drive)">
  <button onclick="guardarQR('banco_union')">Guardar Banco UniÃ³n</button>

  <br><br>

  <input id="linkYasta" placeholder="Pega link Yasta (Drive)">
  <button onclick="guardarQR('yasta')">Guardar Yasta</button>

  <p style="margin-top:15px;">
    âœ… Solo pega el link normal de Drive. El sistema lo convierte solo.
  </p>
</div>

<hr>

<!-- ğŸ‘€ PANEL OPERADORES -->
<div class="card">
  <h2>ğŸ‘€ Operadores solo ven QR</h2>

  <button onclick="verQR('banco_union')">Mostrar Banco UniÃ³n</button>
  <br>
  <img id="imgBanco" width="250">

  <br><br>

  <button onclick="verQR('yasta')">Mostrar Yasta</button>
  <br>
  <img id="imgYasta" width="250">

  <br><br>

  <button onclick="enviarWhats()">ğŸ“² Enviar WhatsApp</button>
</div>

<br>

<button onclick="logout()">Salir</button>

<!-- âœ… FIREBASE -->
<script src="https://www.gstatic.com/firebasejs/10.12.0/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/10.12.0/firebase-firestore-compat.js"></script>

<script>
  const firebaseConfig = {
    apiKey: "AIzaSyDhR3XZX9EG1sLuOvBefZ2EA5GVn8-SggQ",
    authDomain: "panel-jacknniel.firebaseapp.com",
    projectId: "panel-jacknniel",
    storageBucket: "panel-jacknniel.firebasestorage.app",
    messagingSenderId: "130186632575",
    appId: "1:130186632575:web:135d0352564c290d6d0e4a"
  };

  firebase.initializeApp(firebaseConfig);
  const db = firebase.firestore();

  // âœ… VER ROL
  let rol = localStorage.getItem("rol");
  let user = localStorage.getItem("user");

  document.getElementById("rolTexto").innerText =
    "Usuario: " + user + " | Rol: " + rol;

  // SOLO ADMIN VE SUBIDA
  if (rol === "admin") {
    document.getElementById("adminPanel").style.display = "block";
  }

  // âœ… CONVERTIR LINK DRIVE AUTOMÃTICO
  function convertirDrive(link) {

    if (!link.includes("drive.google.com")) return link;

    let id = "";

    // Extraer ID
    if (link.includes("/d/")) {
      id = link.split("/d/")[1].split("/")[0];
    }

    return "https://drive.google.com/uc?export=view&id=" + id;
  }

  // âœ… GUARDAR LINK QR (ADMIN)
  function guardarQR(banco) {

    if (rol !== "admin") {
      alert("âŒ Solo admin puede subir links");
      return;
    }

    let link = "";

    if (banco === "banco_union") {
      link = document.getElementById("linkBanco").value;
    }

    if (banco === "yasta") {
      link = document.getElementById("linkYasta").value;
    }

    // Convertir Drive
    link = convertirDrive(link);

    db.collection("qr_links").doc(banco).set({
      url: link
    });

    alert("âœ… QR guardado correctamente");
  }

  // âœ… VER QR (TODOS)
  function verQR(banco) {

    db.collection("qr_links").doc(banco).get()
      .then((doc) => {

        if (!doc.exists) {
          alert("âŒ No hay QR guardado todavÃ­a");
          return;
        }

        let url = doc.data().url;

        if (banco === "banco_union") {
          document.getElementById("imgBanco").src = url;
        }

        if (banco === "yasta") {
          document.getElementById("imgYasta").src = url;
        }

      });
  }

  // âœ… WHATSAPP
  function enviarWhats() {
    window.open("https://wa.me/60772546", "_blank");
  }

  // âœ… LOGOUT
  function logout() {
    localStorage.clear();
    window.location.href = "login.html";
  }
</script>

</body>
</html>
