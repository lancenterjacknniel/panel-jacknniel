<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="UTF-8">
<meta http-equiv="Content-Security-Policy"
content="default-src 'self'; img-src 'self' data:;">
<title>Panel LAN Center</title>
<link rel="stylesheet" href="style.css">

<style>

body{
background:linear-gradient(135deg,#0f2027,#203a43,#2c5364);
}

.botones-qr{
display:flex;
gap:10px;
margin-top:10px;
}

.botones-qr button{
flex:1;
}

.zoom{
transform:scale(1.5);
z-index:1000;
position:relative;
box-shadow:0 0 25px rgba(0,0,0,0.6);
border-radius:10px;
transition:0.3s ease;
}

.toast{
position:fixed;
bottom:20px;
right:20px;
background:#00c853;
color:white;
padding:10px 20px;
border-radius:10px;
box-shadow:0 5px 15px rgba(0,0,0,0.3);
animation:fadeIn 0.3s ease;
}

@keyframes fadeIn{
from{opacity:0; transform:translateY(10px);}
to{opacity:1; transform:translateY(0);}
}

</style>
</head>

<body>

<!-- HEADER -->
<div class="header-premium">
<div class="top-logo">
<img src="logo.png" class="logo" loading="lazy">
</div>
<h1 class="titulo">PANEL LAN CENTER JACKNNIEL</h1>
<h2 id="rolTexto" class="rol"></h2>
</div>

<hr>

<!-- MEN√ö -->
<div class="menu-botones">
<button class="btn" onclick="mostrarPagos()">üí≥ M√©todos de Pago</button>
<button class="btn" onclick="mostrarPrecios()">üí∞ Precios</button>
<button class="btn" onclick="mostrarGaleria()">üñº Galer√≠a</button>
</div>

<br>

<div id="pagosPanel" class="panel-seccion" style="display:none;">
<h2 class="subtitulo">üí≥ M√âTODOS DE PAGO</h2>
<div id="listaPagos">‚è≥ Cargando m√©todos...</div>
</div>

<div id="preciosPanel" class="panel-seccion" style="display:none;">
<h2 class="subtitulo">üí∞ Cat√°logo de Precios</h2>
<p class="mini">üìå Busca o toca una categor√≠a para desplegar</p>

<input type="text"
id="buscadorPrecios"
class="buscador"
placeholder="üîç Buscar..."
onkeyup="filtrarPrecios()">

<div id="listaPrecios">‚è≥ Cargando precios...</div>
</div>

<div id="galeriaPanel" class="panel-seccion" style="display:none;">
<h2 class="subtitulo">üñº GALER√çA</h2>

<input type="text"
id="buscadorGaleria"
class="buscador"
placeholder="üîç Buscar en galer√≠a..."
onkeyup="filtrarGaleria()">

<div id="listaGaleria">‚è≥ Cargando galer√≠a...</div>
</div>

<br>

<button class="btn-salir" onclick="logout()">Salir</button>

<script>

// ====== SEGURIDAD B√ÅSICA ======

function escaparHTML(texto){
return texto
.replaceAll("&","&amp;")
.replaceAll("<","&lt;")
.replaceAll(">","&gt;");
}

// ====== LOGIN (MEJORADO) ======

let user = sessionStorage.getItem("user");
if (!user) window.location.href="login.html";

let rol = sessionStorage.getItem("rol");
document.getElementById("rolTexto").innerText =
"Usuario: "+user+" | Rol: "+rol;


// ===== CERRAR TODO =====

function cerrarTodo(){
["pagosPanel","preciosPanel","galeriaPanel"].forEach(id=>{
document.getElementById(id).style.display="none";
});
}

// ===== MOSTRAR =====

function mostrarPagos(){
togglePanel("pagosPanel",cargarPagos);
}

function mostrarPrecios(){
togglePanel("preciosPanel",cargarPrecios);
document.getElementById("buscadorPrecios").value="";
}

function mostrarGaleria(){
togglePanel("galeriaPanel",cargarGaleria);
document.getElementById("buscadorGaleria").value="";
}

function togglePanel(id,callback){
let panel=document.getElementById(id);
if(panel.style.display==="block"){
panel.style.display="none";
return;
}
cerrarTodo();
panel.style.display="block";
callback();
}

// ===== PAGOS =====

async function cargarPagos(){

let contenedor=document.getElementById("listaPagos");
const timestamp = Date.now();

try{
const res=await fetch("pagos.txt?v="+timestamp);
const texto=await res.text();

let partes=texto.split("###");
let html="";

for(let i=1;i<partes.length;i+=2){

let categoria=escaparHTML(partes[i].trim());
let contenido=partes[i+1].trim();

html+=`<h2 class="subtitulo">${categoria}</h2><div class="grid">`;

contenido.split("\n").forEach((linea,index)=>{
if(!linea.includes("|")) return;

let [nombre,archivo]=linea.split("|");
nombre=escaparHTML(nombre.trim());
archivo=archivo.trim();

let id="qr-"+nombre.replace(/\W/g,"")+"-"+index;

html+=`
<div class="card-pro">
<h2>${nombre}</h2>
<img id="${id}" class="qr-img" src="${archivo}" loading="lazy"
onclick="zoomQR('${id}')">
<div class="botones-qr">
<button onclick="copiarQR('${id}')">üìã Copiar</button>
<button onclick="descargarQR('${archivo}','${nombre}')">‚¨á Descargar</button>
</div>
</div>
`;
});

html+=`</div>`;
}

contenedor.innerHTML=html;

}catch{
contenedor.innerHTML="<p style='color:red'>Error cargando pagos</p>";
}
}

// ===== PRECIOS =====

async function cargarPrecios(){

let contenedor=document.getElementById("listaPrecios");
const timestamp = Date.now();

try{
const res=await fetch("precios.txt?v="+timestamp);
const texto=await res.text();

let partes=texto.split("###");
let html="";

for(let i=1;i<partes.length;i+=2){

let categoria=escaparHTML(partes[i].trim());
let bloque=partes[i+1].trim();
let visible=escaparHTML(bloque).replaceAll("\n","<br>");

html+=`
<div class="categoria">
<button class="btn-categoria" onclick="toggleCategoria('${categoria}')">
‚ñ∂ ${categoria}
</button>
<div class="contenido" id="cat-${categoria}">
<div class="bloque-precio">
<div class="texto-precio">${visible}</div>
<button onclick="copiarBloque(event,\`${bloque}\`)">
üìã Copiar Todo
</button>
</div>
</div>
</div>
`;
}

contenedor.innerHTML=html;

}catch{
contenedor.innerHTML="<p style='color:red'>Error cargando precios</p>";
}
}

// ===== GALER√çA =====

async function cargarGaleria(){

let contenedor=document.getElementById("listaGaleria");
const timestamp = Date.now();

try{
const res=await fetch("galeria.txt?v="+timestamp);
const texto=await res.text();

let partes=texto.split("###");
let html="";

for(let i=1;i<partes.length;i+=2){

let categoria=escaparHTML(partes[i].trim());
let contenido=partes[i+1].trim();

html+=`<h2 class="subtitulo">${categoria}</h2><div class="grid">`;

contenido.split("\n").forEach((linea,index)=>{

if(!linea.includes("|")) return;

let [nombre,archivo]=linea.split("|");
nombre=escaparHTML(nombre.trim());
archivo=archivo.trim();

let id="gal-"+nombre.replace(/\W/g,"")+"-"+index;

html+=`
<div class="card-pro">
<h2>${nombre}</h2>
<img id="${id}" class="qr-img" src="${archivo}" loading="lazy"
onclick="zoomQR('${id}')">
<div class="botones-qr">
<button onclick="copiarQR('${id}')">üìã Copiar</button>
<button onclick="descargarQR('${archivo}','${nombre}')">‚¨á Descargar</button>
</div>
</div>
`;
});

html+=`</div>`;
}

contenedor.innerHTML=html;

}catch{
contenedor.innerHTML="<p style='color:red'>Error cargando galer√≠a</p>";
}
}

// ===== UTIL =====

function copiarBloque(event,texto){
event.stopPropagation();
navigator.clipboard.writeText(texto);
mostrarMensaje("‚úÖ Copiado");
}

function mostrarMensaje(msg){
let aviso=document.createElement("div");
aviso.innerText=msg;
aviso.className="toast";
document.body.appendChild(aviso);
setTimeout(()=>aviso.remove(),1800);
}

async function copiarQR(idImg){
let img=document.getElementById(idImg);
try{
const response=await fetch(img.src);
const blob=await response.blob();
await navigator.clipboard.write([
new ClipboardItem({[blob.type]:blob})
]);
mostrarMensaje("‚úÖ Imagen copiada");
}catch{
mostrarMensaje("‚ùå No se pudo copiar");
}
}

function descargarQR(archivo,nombre){
let a=document.createElement("a");
a.href=archivo;
a.download=nombre+".png";
a.click();
}

function zoomQR(id){
document.getElementById(id).classList.toggle("zoom");
}

function logout(){
sessionStorage.clear();
window.location.href="login.html";
}

</script>

</body>
</html>
