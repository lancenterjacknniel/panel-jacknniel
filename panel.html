<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="UTF-8">
<title>Panel LAN Center</title>
<link rel="stylesheet" href="style.css">

<style>

.botones-qr{
display:flex;
gap:10px;
margin-top:10px;
}

.botones-qr button{
flex:1;
}

.zoom{
transform:scale(1.3);
z-index:1000;
position:relative;
}

</style>

</head>

<body>

<div class="header-premium">
<div class="top-logo">
<img src="logo.png" class="logo">
</div>
<h1 class="titulo">PANEL LAN CENTER JACKNNIEL</h1>
<h2 id="rolTexto" class="rol"></h2>
</div>

<hr>

<div class="menu-botones">
<button class="btn" onclick="mostrarPagos()">üí≥ M√©todos de Pago</button>
<button class="btn" onclick="mostrarPrecios()">üí∞ Precios</button>
<button class="btn" onclick="mostrarGaleria()">üñº Galer√≠a</button>
<button class="btn" onclick="mostrarMensajes()">üí¨ Mensajes R√°pidos</button>
</div>

<br>

<!-- PAGOS -->
<div id="pagosPanel" class="panel-seccion" style="display:none;">
<h2 class="subtitulo">üí≥ M√âTODOS DE PAGO</h2>
<div id="listaPagos">‚è≥ Cargando m√©todos...</div>
</div>

<!-- PRECIOS -->
<div id="preciosPanel" class="panel-seccion" style="display:none;">
<h2 class="subtitulo">üí∞ Cat√°logo de Precios</h2>

<input type="text"
id="buscadorPrecios"
class="buscador"
placeholder="üîç Buscar..."
onkeyup="filtrarPrecios()">

<div id="listaPrecios">‚è≥ Cargando precios...</div>
</div>

<!-- GALERIA -->
<div id="galeriaPanel" class="panel-seccion" style="display:none;">
<h2 class="subtitulo">üñº GALER√çA</h2>

<input type="text"
id="buscadorGaleria"
class="buscador"
placeholder="üîç Buscar en galer√≠a..."
onkeyup="filtrarGaleria()">

<div id="listaGaleria">‚è≥ Cargando galer√≠a...</div>
</div>

<!-- MENSAJES -->
<div id="mensajesPanel" class="panel-seccion" style="display:none;">
<h2 class="subtitulo">üí¨ MENSAJES R√ÅPIDOS</h2>

<input type="text"
id="buscadorMensajes"
class="buscador"
placeholder="üîç Buscar mensaje..."
onkeyup="filtrarMensajes()">

<div id="listaMensajes">‚è≥ Cargando mensajes...</div>
</div>

<br>
<button class="btn-salir" onclick="logout()">Salir</button>

<script>

// LOGIN
let user = localStorage.getItem("user");
if (!user) window.location.href="login.html";

let rol = localStorage.getItem("rol");
document.getElementById("rolTexto").innerText =
"Usuario: "+user+" | Rol: "+rol;

// CERRAR TODO
function cerrarTodo(){
document.getElementById("pagosPanel").style.display="none";
document.getElementById("preciosPanel").style.display="none";
document.getElementById("galeriaPanel").style.display="none";
document.getElementById("mensajesPanel").style.display="none";
}

// MOSTRAR
function mostrarPagos(){
let panel=document.getElementById("pagosPanel");
if(panel.style.display==="block"){panel.style.display="none";return;}
cerrarTodo();panel.style.display="block";cargarPagos();
}

function mostrarPrecios(){
let panel=document.getElementById("preciosPanel");
if(panel.style.display==="block"){panel.style.display="none";return;}
cerrarTodo();panel.style.display="block";
cargarPrecios();
document.getElementById("buscadorPrecios").value="";
}

function mostrarGaleria(){
let panel=document.getElementById("galeriaPanel");
if(panel.style.display==="block"){panel.style.display="none";return;}
cerrarTodo();panel.style.display="block";
cargarGaleria();
document.getElementById("buscadorGaleria").value="";
}

function mostrarMensajes(){
let panel=document.getElementById("mensajesPanel");
if(panel.style.display==="block"){panel.style.display="none";return;}
cerrarTodo();panel.style.display="block";
cargarMensajes();
document.getElementById("buscadorMensajes").value="";
}

// ================= MENSAJES =================

async function cargarMensajes(){

let contenedor=document.getElementById("listaMensajes");

try{

const res=await fetch("mensajes.txt?v="+new Date().getTime());
const texto=await res.text();

let partes=texto.split("###");
let html="";

for(let i=1;i<partes.length;i+=2){

let categoria=partes[i].trim();
let bloque=partes[i+1].trim();

let lineas=bloque.split("\n");
let contenidoHTML="";
let textoParaCopiar="";

lineas.forEach(linea=>{

if(linea.startsWith("IMG|")){
let archivo=linea.replace("IMG|","").trim();
let id="msg-"+archivo.replaceAll(".","");

contenidoHTML+=`
<img id="${id}" class="qr-img"
src="${archivo}" onclick="zoomQR('${id}')">

<div class="botones-qr">
<button class="btn-copy" onclick="copiarQR('${id}')">üìã Copiar Imagen</button>
<button class="btn-download" onclick="descargarQR('${archivo}','imagen')">‚¨á Descargar</button>
</div>
`;

}else{
contenidoHTML+=linea+"<br>";
textoParaCopiar+=linea+"\n";
}

});

html+=`
<div class="categoria">
<button class="btn-categoria"
onclick="toggleCategoria('msg-${categoria}')">
‚ñ∂ ${categoria}
</button>

<div class="contenido" id="cat-msg-${categoria}">
<div class="bloque-precio">
<div class="texto-precio">${contenidoHTML}</div>

<button class="btn-copiar-todo"
onclick="copiarBloque(event,\`${textoParaCopiar}\`)">
üìã Copiar Mensaje
</button>

</div>
</div>
</div>
`;

}

contenedor.innerHTML=html;

}catch{
contenedor.innerHTML="<p style='color:red'>Error cargando mensajes</p>";
}
}

function filtrarMensajes(){
let input=document.getElementById("buscadorMensajes").value.toLowerCase();
document.querySelectorAll("#listaMensajes .categoria").forEach(cat=>{
let texto=cat.innerText.toLowerCase();
cat.style.display=texto.includes(input)||input===""?"block":"none";
});
}

// ================= UTIL =================

function toggleCategoria(cat){
let div=document.getElementById("cat-"+cat);
if(!div)return;

if(div.classList.contains("abierto")){
div.classList.remove("abierto");
div.style.maxHeight="0px";
return;
}

document.querySelectorAll(".contenido").forEach(c=>{
c.classList.remove("abierto");
c.style.maxHeight="0px";
});

div.classList.add("abierto");
div.style.maxHeight=div.scrollHeight+"px";
}

function copiarBloque(event,texto){
event.stopPropagation();
navigator.clipboard.writeText(texto);
mostrarMensaje("‚úÖ Copiado");
}

function mostrarMensaje(msg){
let aviso=document.createElement("div");
aviso.innerText=msg;
aviso.className="toast";
document.body.appendChild(aviso);
setTimeout(()=>aviso.remove(),1800);
}

async function copiarQR(idImg){
let img=document.getElementById(idImg);
try{
const response=await fetch(img.src);
const blob=await response.blob();
await navigator.clipboard.write([
new ClipboardItem({[blob.type]:blob})
]);
mostrarMensaje("‚úÖ Imagen copiada");
}catch{
mostrarMensaje("‚ùå No se pudo copiar");
}
}

function descargarQR(archivo,nombre){
let a=document.createElement("a");
a.href=archivo;
a.download=nombre+".png";
a.click();
}

function zoomQR(id){
document.getElementById(id).classList.toggle("zoom");
}

function logout(){
localStorage.clear();
window.location.href="login.html";
}

</script>

</body>
</html>
