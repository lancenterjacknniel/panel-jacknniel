<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8">
  <title>Panel LAN Center</title>
  <link rel="stylesheet" href="style.css">
</head>
<body>

<h1 class="titulo">ğŸš€ PANEL LAN CENTER JACKNNIEL</h1>

<h2 id="rolTexto" class="rol"></h2>

<!-- ğŸ” ADMIN INFO -->
<div id="adminPanel" class="admin-box" style="display:none;">
  <h2>ğŸ” Admin: Subir QR desde GitHub</h2>

  <p>Para cambiar un QR solo reemplaza estos archivos:</p>

  <div class="files">
    <span>âœ… qr_banco.png</span>
    <span>âœ… qr_yasta.png</span>
  </div>

  <a class="btn-repo"
     href="https://github.com/lancenterjacknniel/panel-jacknniel"
     target="_blank">
     ğŸ‘‰ Ir al Repo y subir QR
  </a>
</div>

<hr>

<!-- âœ… BOTONES PRINCIPALES -->
<button class="btn" onclick="mostrarPagos()">
  ğŸ’³ MÃ©todos de Pago
</button>

<button class="btn" onclick="mostrarPrecios()">
  ğŸ’° Precios
</button>

<br><br>

<!-- âœ… PANEL OCULTO QR -->
<div id="pagosPanel" style="display:none;">

  <div class="grid">

    <!-- BANCO UNION -->
    <div class="card-pro">
      <h2>Banco UniÃ³n</h2>

      <img id="imgBanco"
           class="qr-img"
           src="qr_banco.png"
           onclick="zoomQR('imgBanco')">

      <br>

      <button class="btn-copy" onclick="copiarQR('imgBanco')">
        ğŸ“‹ Copiar QR
      </button>

      <button class="btn-download"
              onclick="descargarQR('qr_banco.png','BancoUnion')">
        â¬‡ Descargar
      </button>
    </div>

    <!-- YASTA -->
    <div class="card-pro">
      <h2>Yasta</h2>

      <img id="imgYasta"
           class="qr-img"
           src="qr_yasta.png"
           onclick="zoomQR('imgYasta')">

      <br>

      <button class="btn-copy" onclick="copiarQR('imgYasta')">
        ğŸ“‹ Copiar QR
      </button>

      <button class="btn-download"
              onclick="descargarQR('qr_yasta.png','Yasta')">
        â¬‡ Descargar
      </button>
    </div>

  </div>

</div>

<!-- âœ… PANEL OCULTO PRECIOS -->
<div id="preciosPanel" style="display:none;" class="admin-box">

  <h2>ğŸ’° CatÃ¡logo de Precios</h2>
  <p>ğŸ“Œ Toca cualquier bloque para copiar completo</p>

  <div id="listaPrecios">
    â³ Cargando precios...
  </div>

</div>

<br>

<button class="btn-salir" onclick="logout()">Salir</button>

<!-- âœ… FUNCIONES -->
<script>
  // Mostrar rol
  let rol = localStorage.getItem("rol");
  let user = localStorage.getItem("user");

  document.getElementById("rolTexto").innerText =
    "Usuario: " + user + " | Rol: " + rol;

  // Solo admin ve panel superior
  if (rol === "admin") {
    document.getElementById("adminPanel").style.display = "block";
  }

  // Mostrar/Ocultar mÃ©todos de pago
  function mostrarPagos() {
    let panel = document.getElementById("pagosPanel");
    panel.style.display =
      (panel.style.display === "none") ? "block" : "none";
  }

  // Mostrar/Ocultar precios
  function mostrarPrecios() {
    let panel = document.getElementById("preciosPanel");

    if (panel.style.display === "none") {
      panel.style.display = "block";
      cargarPrecios();
    } else {
      panel.style.display = "none";
    }
  }

  // âœ… CARGAR PRECIOS DESDE precios.txt POR BLOQUES
  async function cargarPrecios() {

    let contenedor = document.getElementById("listaPrecios");

    try {

      const res = await fetch("precios.txt");
      const texto = await res.text();

      // ğŸ”¥ Bloques separados por ###INICIO###
      let bloques = texto.split("###INICIO###");

      let html = "";

      bloques.forEach((bloque) => {

        bloque = bloque.trim();
        if (bloque === "") return;

        // Cortar en ###FIN###
        bloque = bloque.split("###FIN###")[0].trim();

        // Mostrar saltos en pantalla
        let visible = bloque.replaceAll("\n", "<br>");

        html += `
          <div class="precio-item"
               onclick="copiarPrecio(\`${bloque}\`)">
            ${visible}
          </div>
        `;
      });

      contenedor.innerHTML = html;

    } catch (error) {

      contenedor.innerHTML =
        "<p style='color:red;'>âŒ No se pudieron cargar los precios</p>";

    }
  }

  // âœ… Copiar bloque completo
  function copiarPrecio(texto) {
    navigator.clipboard.writeText(texto);
    mostrarMensaje("âœ… Copiado correctamente");
  }

  // âœ… Mensaje bonito abajo
  function mostrarMensaje(msg) {

    let aviso = document.createElement("div");
    aviso.innerText = msg;

    aviso.style.position = "fixed";
    aviso.style.bottom = "30px";
    aviso.style.left = "50%";
    aviso.style.transform = "translateX(-50%)";
    aviso.style.background = "lime";
    aviso.style.color = "black";
    aviso.style.padding = "15px 25px";
    aviso.style.borderRadius = "15px";
    aviso.style.fontWeight = "bold";
    aviso.style.boxShadow = "0 0 20px lime";
    aviso.style.zIndex = "9999";

    document.body.appendChild(aviso);

    setTimeout(() => {
      aviso.remove();
    }, 1800);
  }

  // Copiar QR como imagen
  async function copiarQR(idImg) {

    let img = document.getElementById(idImg);

    try {
      const response = await fetch(img.src);
      const blob = await response.blob();

      await navigator.clipboard.write([
        new ClipboardItem({ [blob.type]: blob })
      ]);

      mostrarMensaje("âœ… QR copiado como imagen");

    } catch (error) {
      mostrarMensaje("âŒ No se pudo copiar QR");
    }
  }

  // Descargar QR
  function descargarQR(archivo, nombre) {
    let a = document.createElement("a");
    a.href = archivo;
    a.download = nombre + ".png";
    a.click();
  }

  // Zoom QR en el mismo lugar
  function zoomQR(idImg) {
    let img = document.getElementById(idImg);
    img.classList.toggle("zoom");
  }

  // Logout
  function logout() {
    localStorage.clear();
    window.location.href = "login.html";
  }
</script>

</body>
</html>
