<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="UTF-8">
<title>Panel LAN Center</title>
<link rel="stylesheet" href="style.css">

<style>

/* ===== ESTILO EXTRA PREMIUM ===== */

.galeria-grid{
display:grid;
grid-template-columns:repeat(auto-fit,minmax(280px,1fr));
gap:30px;
margin-top:25px;
}

.card-img{
background:#0f172a;
padding:20px;
border-radius:20px;
box-shadow:0 0 25px rgba(0,255,255,0.4);
text-align:center;
transition:0.3s;
}

.card-img:hover{
transform:scale(1.04);
box-shadow:0 0 35px rgba(0,255,0,0.6);
}

.card-img img{
width:100%;
max-height:420px;
object-fit:cover;
border-radius:15px;
cursor:pointer;
transition:0.3s;
}

.card-img img:hover{
transform:scale(1.05);
}

.botones-img{
display:flex;
gap:12px;
margin-top:15px;
}

.botones-img button{
flex:1;
padding:10px;
border:none;
border-radius:12px;
cursor:pointer;
font-weight:bold;
}

.btn-link{background:#00eaff;color:black;}
.btn-download{background:#00ff9d;color:black;}

.botones-qr{
display:flex;
gap:10px;
margin-top:10px;
}

.botones-qr button{
flex:1;
}

/* ZOOM */
.zoom{
transform:scale(1.3);
z-index:1000;
position:relative;
}

</style>

</head>

<body>

<!-- HEADER -->
<div class="header-premium">
<div class="top-logo">
<img src="logo.png" class="logo">
</div>
<h1 class="titulo">PANEL LAN CENTER JACKNNIEL</h1>
<h2 id="rolTexto" class="rol"></h2>
</div>

<hr>

<!-- MEN√ö -->
<div class="menu-botones">
<button class="btn" onclick="mostrarPagos()">üí≥ M√©todos de Pago</button>
<button class="btn" onclick="mostrarPrecios()">üí∞ Precios</button>
<button class="btn" onclick="mostrarGaleria()">üñº Galer√≠a</button>
</div>

<br>

<!-- PANEL PAGOS -->
<div id="pagosPanel" class="panel-seccion" style="display:none;">
<h2 class="subtitulo">üí≥ M√âTODOS DE PAGO</h2>
<div id="listaPagos">‚è≥ Cargando m√©todos...</div>
</div>

<!-- PANEL PRECIOS -->
<div id="preciosPanel" class="panel-seccion" style="display:none;">
<h2 class="subtitulo">üí∞ Cat√°logo de Precios</h2>
<p class="mini">üìå Busca o toca una categor√≠a para desplegar</p>

<input type="text"
id="buscadorPrecios"
class="buscador"
placeholder="üîç Buscar..."
onkeyup="filtrarPrecios()">

<div id="listaPrecios">‚è≥ Cargando precios...</div>
</div>

<!-- PANEL GALER√çA -->
<div id="galeriaPanel" class="panel-seccion" style="display:none;">
<h2 class="subtitulo">üñº GALER√çA</h2>

<input type="text"
id="buscadorGaleria"
class="buscador"
placeholder="üîç Buscar categor√≠a..."
onkeyup="filtrarGaleria()">

<div id="listaGaleria">‚è≥ Cargando galer√≠a...</div>
</div>

<br>

<button class="btn-salir" onclick="logout()">Salir</button>

<script>

// üîí LOGIN
let user = localStorage.getItem("user");
if (!user) window.location.href="login.html";

let rol = localStorage.getItem("rol");
document.getElementById("rolTexto").innerText =
"Usuario: "+user+" | Rol: "+rol;

// ===== MOSTRAR SECCIONES =====

function mostrarPagos(){
let panel=document.getElementById("pagosPanel");
panel.style.display=(panel.style.display==="none")?"block":"none";
if(panel.style.display==="block") cargarPagos();
}

function mostrarPrecios(){
let panel=document.getElementById("preciosPanel");
panel.style.display=(panel.style.display==="none")?"block":"none";
if(panel.style.display==="block"){
cargarPrecios();
document.getElementById("buscadorPrecios").value="";
}
}

function mostrarGaleria(){
let panel=document.getElementById("galeriaPanel");
panel.style.display=(panel.style.display==="none")?"block":"none";
if(panel.style.display==="block"){
cargarGaleria();
document.getElementById("buscadorGaleria").value="";
}
}

// ===== PAGOS =====

async function cargarPagos(){

let contenedor=document.getElementById("listaPagos");

try{
const res=await fetch("pagos.txt?v="+new Date().getTime());
const texto=await res.text();

let partes=texto.split("###");
let html="";

for(let i=1;i<partes.length;i+=2){

let categoria=partes[i].trim();
let contenido=partes[i+1].trim();

html+=`<h2 class="subtitulo">${categoria}</h2><div class="grid">`;

contenido.split("\n").forEach(linea=>{
if(!linea.includes("|")) return;

let datos=linea.split("|");
let nombre=datos[0].trim();
let archivo=datos[1].trim();
let id="qr-"+nombre.replaceAll(" ","");

html+=`
<div class="card-pro">
<h2>${nombre}</h2>
<img id="${id}" class="qr-img" src="${archivo}" onclick="zoomQR('${id}')">
<div class="botones-qr">
<button class="btn-copy" onclick="copiarQR('${id}')">üìã Copiar</button>
<button class="btn-download" onclick="descargarQR('${archivo}','${nombre}')">‚¨á Descargar</button>
</div>
</div>
`;
});

html+=`</div>`;
}

contenedor.innerHTML=html;

}catch{
contenedor.innerHTML="<p style='color:red'>Error cargando pagos</p>";
}
}

// ===== PRECIOS =====

async function cargarPrecios(){

let contenedor=document.getElementById("listaPrecios");

try{
const res=await fetch("precios.txt?v="+new Date().getTime());
const texto=await res.text();

let partes=texto.split("###");
let html="";

for(let i=1;i<partes.length;i+=2){

let categoria=partes[i].trim();
let bloque=partes[i+1].trim();
let visible=bloque.replaceAll("\n","<br>");

html+=`
<div class="categoria">
<button class="btn-categoria" onclick="toggleCategoria('${categoria}')">
‚ñ∂ ${categoria}
</button>
<div class="contenido" id="cat-${categoria}">
<div class="bloque-precio">
<div class="texto-precio">${visible}</div>
<button class="btn-copiar-todo"
onclick="copiarBloque(event,\`${bloque}\`)">
üìã Copiar Todo
</button>
</div>
</div>
</div>
`;
}

contenedor.innerHTML=html;

}catch{
contenedor.innerHTML="<p style='color:red'>Error cargando precios</p>";
}
}

function toggleCategoria(cat){

let div=document.getElementById("cat-"+cat);

if(div.classList.contains("abierto")){
div.classList.remove("abierto");
div.style.maxHeight="0px";
return;
}

document.querySelectorAll(".contenido").forEach(c=>{
c.classList.remove("abierto");
c.style.maxHeight="0px";
});

div.classList.add("abierto");
div.style.maxHeight=div.scrollHeight+"px";
}

function filtrarPrecios(){

let input=document.getElementById("buscadorPrecios").value.toLowerCase();

document.querySelectorAll(".categoria").forEach(cat=>{

let texto=cat.innerText.toLowerCase();
let contenido=cat.querySelector(".contenido");

if(input.trim()===""){
cat.style.display="block";
contenido.classList.remove("abierto");
contenido.style.maxHeight="0px";
return;
}

if(texto.includes(input)){
cat.style.display="block";
contenido.classList.add("abierto");
contenido.style.maxHeight=contenido.scrollHeight+"px";
}else{
cat.style.display="none";
}
});
}

// ===== GALER√çA =====

async function cargarGaleria(){

let contenedor=document.getElementById("listaGaleria");

try{
const res=await fetch("galeria.txt?v="+new Date().getTime());
const texto=await res.text();

let partes=texto.split("###");
let html="";

for(let i=1;i<partes.length;i+=2){

let categoria=partes[i].trim();
let contenido=partes[i+1].trim().split("\n").filter(l=>l.trim()!=="");

html+=`<h3 style="color:#00f0ff">${categoria}</h3>`;
html+=`<div class="galeria-grid">`;

contenido.forEach(link=>{
html+=`
<div class="card-img">
<img src="${link}" onclick="zoomQR(this.id)" id="img${Math.random()}">
<div class="botones-img">
<button class="btn-link" onclick="copiarLink('${link}')">üìã Copiar</button>
<button class="btn-download" onclick="descargarImagen('${link}')">‚¨á Descargar</button>
</div>
</div>
`;
});

html+=`</div>`;
}

contenedor.innerHTML=html;

}catch{
contenedor.innerHTML="<p style='color:red'>Error cargando galer√≠a</p>";
}
}

function copiarLink(link){
navigator.clipboard.writeText(link);
mostrarMensaje("‚úÖ Link copiado");
}

function descargarImagen(link){
let a=document.createElement("a");
a.href=link;
a.download="imagen.png";
a.click();
}

function filtrarGaleria(){
let input=document.getElementById("buscadorGaleria").value.toLowerCase();
document.querySelectorAll("#listaGaleria h3").forEach(h=>{
let bloque=h.nextElementSibling;
if(h.innerText.toLowerCase().includes(input)||input===""){
h.style.display="block";
bloque.style.display="grid";
}else{
h.style.display="none";
bloque.style.display="none";
}
});
}

// ===== UTIL =====

function copiarBloque(event,texto){
event.stopPropagation();
navigator.clipboard.writeText(texto);
mostrarMensaje("‚úÖ Copiado");
}

function mostrarMensaje(msg){
let aviso=document.createElement("div");
aviso.innerText=msg;
aviso.className="toast";
document.body.appendChild(aviso);
setTimeout(()=>aviso.remove(),1800);
}

async function copiarQR(idImg){
let img=document.getElementById(idImg);
try{
const response=await fetch(img.src);
const blob=await response.blob();
await navigator.clipboard.write([
new ClipboardItem({[blob.type]:blob})
]);
mostrarMensaje("‚úÖ QR copiado");
}catch{
mostrarMensaje("‚ùå No se pudo copiar");
}
}

function descargarQR(archivo,nombre){
let a=document.createElement("a");
a.href=archivo;
a.download=nombre+".png";
a.click();
}

function zoomQR(id){
document.getElementById(id).classList.toggle("zoom");
}

function logout(){
localStorage.clear();
window.location.href="login.html";
}

</script>

</body>
</html>
