<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="UTF-8">
<title>Panel LAN Center</title>
<link rel="stylesheet" href="style.css">

<style>

.botones-qr{
display:flex;
gap:10px;
margin-top:10px;
}

.botones-qr button{
flex:1;
}

.zoom{
transform:scale(1.3);
z-index:1000;
position:relative;
}

</style>

</head>

<body>

<!-- HEADER -->
<div class="header-premium">
<div class="top-logo">
<img src="logo.png" class="logo">
</div>
<h1 class="titulo">PANEL LAN CENTER JACKNNIEL</h1>
<h2 id="rolTexto" class="rol"></h2>
</div>

<hr>

<!-- MEN√ö -->
<div class="menu-botones">
<button class="btn" onclick="mostrarPagos()">üí≥ M√©todos de Pago</button>
<button class="btn" onclick="mostrarPrecios()">üí∞ Precios</button>
<button class="btn" onclick="mostrarGaleria()">üñº Galer√≠a</button>
<button class="btn" onclick="mostrarMensajes()">üí¨ Mensajes R√°pidos</button>
</div>

<br>

<!-- PANEL PAGOS -->
<div id="pagosPanel" class="panel-seccion" style="display:none;">
<h2 class="subtitulo">üí≥ M√âTODOS DE PAGO</h2>
<div id="listaPagos">‚è≥ Cargando m√©todos...</div>
</div>

<!-- PANEL PRECIOS -->
<div id="preciosPanel" class="panel-seccion" style="display:none;">
<h2 class="subtitulo">üí∞ Cat√°logo de Precios</h2>
<p class="mini">üìå Busca o toca una categor√≠a para desplegar</p>

<input type="text"
id="buscadorPrecios"
class="buscador"
placeholder="üîç Buscar..."
onkeyup="filtrarPrecios()">

<div id="listaPrecios">‚è≥ Cargando precios...</div>
</div>

<!-- PANEL GALER√çA -->
<div id="galeriaPanel" class="panel-seccion" style="display:none;">
<h2 class="subtitulo">üñº GALER√çA</h2>

<input type="text"
id="buscadorGaleria"
class="buscador"
placeholder="üîç Buscar en galer√≠a..."
onkeyup="filtrarGaleria()">

<div id="listaGaleria">‚è≥ Cargando galer√≠a...</div>
</div>

<!-- PANEL MENSAJES -->
<div id="mensajesPanel" class="panel-seccion" style="display:none;">
<h2 class="subtitulo">üí¨ MENSAJES R√ÅPIDOS</h2>

<input type="text"
id="buscadorMensajes"
class="buscador"
placeholder="üîç Buscar mensaje..."
onkeyup="filtrarMensajes()">

<div id="listaMensajes">‚è≥ Cargando mensajes...</div>
</div>

<br>

<button class="btn-salir" onclick="logout()">Salir</button>

<script>

// üîí LOGIN
let user = localStorage.getItem("user");
if (!user) window.location.href="login.html";

let rol = localStorage.getItem("rol");
document.getElementById("rolTexto").innerText =
"Usuario: "+user+" | Rol: "+rol;


// ===== CERRAR TODO =====

function cerrarTodo(){
document.getElementById("pagosPanel").style.display="none";
document.getElementById("preciosPanel").style.display="none";
document.getElementById("galeriaPanel").style.display="none";
document.getElementById("mensajesPanel").style.display="none";
}


// ===== MOSTRAR PAGOS =====

function mostrarPagos(){

let panel=document.getElementById("pagosPanel");

if(panel.style.display==="block"){
panel.style.display="none";
return;
}

cerrarTodo();
panel.style.display="block";
cargarPagos();
}


// ===== MOSTRAR PRECIOS =====

function mostrarPrecios(){

let panel=document.getElementById("preciosPanel");

if(panel.style.display==="block"){
panel.style.display="none";
return;
}

cerrarTodo();
panel.style.display="block";
cargarPrecios();
document.getElementById("buscadorPrecios").value="";
}


// ===== MOSTRAR GALER√çA =====

function mostrarGaleria(){

let panel=document.getElementById("galeriaPanel");

if(panel.style.display==="block"){
panel.style.display="none";
return;
}

cerrarTodo();
panel.style.display="block";
cargarGaleria();
document.getElementById("buscadorGaleria").value="";
}


function mostrarMensajes(){

let panel=document.getElementById("mensajesPanel");

if(panel.style.display==="block"){
panel.style.display="none";
return;
}

cerrarTodo();
panel.style.display="block";
cargarMensajes();
document.getElementById("buscadorMensajes").value="";
}


function toggleMensajes(cat){

let div=document.getElementById("msg-"+cat);

if(div.classList.contains("abierto")){
div.classList.remove("abierto");
div.style.maxHeight="0px";
return;
}

document.querySelectorAll("#listaMensajes .contenido").forEach(c=>{
c.classList.remove("abierto");
c.style.maxHeight="0px";
});

div.classList.add("abierto");
div.style.maxHeight=div.scrollHeight+"px";
}
  

// ===== PAGOS =====

async function cargarPagos(){

let contenedor=document.getElementById("listaPagos");

try{
const res=await fetch("pagos.txt?v="+new Date().getTime());
const texto=await res.text();

let partes=texto.split("###");
let html="";

for(let i=1;i<partes.length;i+=2){

let categoria=partes[i].trim();
let contenido=partes[i+1].trim();

html+=`<h2 class="subtitulo">${categoria}</h2><div class="grid">`;

contenido.split("\n").forEach(linea=>{
if(!linea.includes("|")) return;

let datos=linea.split("|");
let nombre=datos[0].trim();
let archivo=datos[1].trim();
let id="qr-"+nombre.replaceAll(" ","");

html+=`
<div class="card-pro">
<h2>${nombre}</h2>
<img id="${id}" class="qr-img" src="${archivo}" onclick="zoomQR('${id}')">
<div class="botones-qr">
<button class="btn-copy" onclick="copiarQR('${id}')">üìã Copiar</button>
<button class="btn-download" onclick="descargarQR('${archivo}','${nombre}')">‚¨á Descargar</button>
</div>
</div>
`;
});

html+=`</div>`;
}

contenedor.innerHTML=html;

}catch{
contenedor.innerHTML="<p style='color:red'>Error cargando pagos</p>";
}
}


// ===== PRECIOS =====

async function cargarPrecios(){

let contenedor=document.getElementById("listaPrecios");

try{
const res=await fetch("precios.txt?v="+new Date().getTime());
const texto=await res.text();

let partes=texto.split("###");
let html="";

for(let i=1;i<partes.length;i+=2){

let categoria=partes[i].trim();
let bloque=partes[i+1].trim();
let visible=bloque.replaceAll("\n","<br>");

html+=`
<div class="categoria">
<button class="btn-categoria" onclick="toggleCategoria('${categoria}')">
‚ñ∂ ${categoria}
</button>
<div class="contenido" id="cat-${categoria}">
<div class="bloque-precio">
<div class="texto-precio">${visible}</div>
<button class="btn-copiar-todo"
onclick="copiarBloque(event,\`${bloque}\`)">
üìã Copiar Todo
</button>
</div>
</div>
</div>
`;
}

contenedor.innerHTML=html;

}catch{
contenedor.innerHTML="<p style='color:red'>Error cargando precios</p>";
}
}

async function cargarMensajes(){

let contenedor=document.getElementById("listaMensajes");
let html="";

html += await crearCategoriaMensajes("LAN CENTER JACKNNIEL","mensajes_lan.txt");
html += await crearCategoriaMensajes("GAME LOAD BOLIVIA","mensajes_game.txt");

contenedor.innerHTML=html;
}


// üî• FUNCI√ìN PARA CREAR CADA CATEGOR√çA
async function crearCategoriaMensajes(titulo,archivo){

let visible=titulo.replaceAll(" ","_");
let html="";

html+=`
<div class="categoria">
<button class="btn-categoria" onclick="toggleMensajes('${visible}')">
‚ñ∂ ${titulo}
</button>

<div class="contenido" id="msg-${visible}">
<div class="grid">
`;

try{

const res=await fetch(archivo+"?v="+new Date().getTime());
const texto=await res.text();

let contenido=texto.trim();
let lineas=contenido.split("\n");

let nombreActual="";
let textoAcumulado="";

lineas.forEach(linea=>{

if(linea.includes("|")){

if(nombreActual && textoAcumulado){

let textoSeguro = textoAcumulado
.replaceAll("&","&amp;")
.replaceAll("<","&lt;")
.replaceAll(">","&gt;");

html+=`
<div class="card-pro">
<h2>${nombreActual}</h2>
<div style="padding:15px;background:#111;border-radius:10px;margin-bottom:10px;white-space:pre-line;">
${textoSeguro}
</div>
<div class="botones-qr">
<button class="btn-copy"
onclick="navigator.clipboard.writeText(\`${textoAcumulado}\`);mostrarMensaje('‚úÖ Mensaje copiado');">
üìã Copiar
</button>
</div>
</div>
`;
}

let partesLinea=linea.split("|");
nombreActual=partesLinea[0].trim();
textoAcumulado=partesLinea[1].trim();

if(textoAcumulado.match(/\.(png|jpg|jpeg|webp|gif)$/i)){

let id="msgimg-"+nombreActual.replaceAll(" ","");

html+=`
<div class="card-pro">
<h2>${nombreActual}</h2>
<img id="${id}" class="qr-img" src="${textoAcumulado}" onclick="zoomQR('${id}')">
<div class="botones-qr">
<button class="btn-copy" onclick="copiarQR('${id}')">üìã Copiar</button>
<button class="btn-download" onclick="descargarQR('${textoAcumulado}','${nombreActual}')">‚¨á Descargar</button>
</div>
</div>
`;

nombreActual="";
textoAcumulado="";
}

}else{

textoAcumulado += "\n" + linea;

}

});

// üî• Mostrar √∫ltimo bloque pendiente
if(nombreActual && textoAcumulado){

let textoSeguro = textoAcumulado
.replaceAll("&","&amp;")
.replaceAll("<","&lt;")
.replaceAll(">","&gt;");

html+=`
<div class="card-pro">
<h2>${nombreActual}</h2>
<div style="padding:15px;background:#111;border-radius:10px;margin-bottom:10px;white-space:pre-line;">
${textoSeguro}
</div>
<div class="botones-qr">
<button class="btn-copy"
onclick="navigator.clipboard.writeText(\`${textoAcumulado}\`);mostrarMensaje('‚úÖ Mensaje copiado');">
üìã Copiar
</button>
</div>
</div>
`;
}

}catch{
html+=`<p style="color:red">Error cargando ${archivo}</p>`;
}

html+=`
</div>
</div>
</div>
`;

return html;
}


function toggleCategoria(cat){

let div=document.getElementById("cat-"+cat);

if(div.classList.contains("abierto")){
div.classList.remove("abierto");
div.style.maxHeight="0px";
return;
}

document.querySelectorAll(".contenido").forEach(c=>{
c.classList.remove("abierto");
c.style.maxHeight="0px";
});

div.classList.add("abierto");
div.style.maxHeight=div.scrollHeight+"px";
}


function filtrarPrecios() {
    let input = document.getElementById("buscadorPrecios").value.toLowerCase();

    // üîπ Si est√° vac√≠o ‚Üí volver al estado original
    if (input.trim() === "") {

        document.querySelectorAll("#listaPrecios .bloque-precio").forEach(card => {
            card.style.display = "block";
        });

        document.querySelectorAll("#listaPrecios .categoria").forEach(cat => {
            cat.style.display = "block";

            let contenido = cat.querySelector(".contenido");
            if (contenido) {
                contenido.classList.remove("abierto");
                contenido.style.maxHeight = "0px";
            }
        });

        return;
    }

    // üîπ Buscar por bloque individual
    document.querySelectorAll("#listaPrecios .bloque-precio").forEach(card => {
        let texto = card.innerText.toLowerCase();

        if (texto.includes(input)) {
            card.style.display = "block";
        } else {
            card.style.display = "none";
        }
    });

    // üîπ Mostrar solo categor√≠as que tengan coincidencia
    document.querySelectorAll("#listaPrecios .categoria").forEach(cat => {

        let tarjetas = cat.querySelectorAll(".bloque-precio");
        let algunaVisible = false;

        tarjetas.forEach(t => {
            if (t.style.display !== "none") {
                algunaVisible = true;
            }
        });

        if (algunaVisible) {
            cat.style.display = "block";

            let contenido = cat.querySelector(".contenido");
            if (contenido) {
                contenido.classList.add("abierto");
                contenido.style.maxHeight = contenido.scrollHeight + "px";
            }

        } else {
            cat.style.display = "none";
        }
    });
}


// ===== GALER√çA (IGUAL A PAGOS + BUSCADOR) =====

async function cargarGaleria(){

let contenedor=document.getElementById("listaGaleria");

try{
const res=await fetch("galeria.txt?v="+new Date().getTime());
const texto=await res.text();

let partes=texto.split("###");
let html="";

for(let i=1;i<partes.length;i+=2){

let categoria=partes[i].trim();
let contenido=partes[i+1].trim();

html+=`<div class="bloque-galeria" data-cat="${categoria.toLowerCase()}">`;
html+=`<h2 class="subtitulo">${categoria}</h2><div class="grid">`;

contenido.split("\n").forEach(linea=>{

if(!linea.includes("|")) return;

let datos=linea.split("|");
let nombre=datos[0].trim();
let archivo=datos[1].trim();
let id="gal-"+nombre.replaceAll(" ","");

html+=`
<div class="card-pro">
<h2>${nombre}</h2>
<img id="${id}" class="qr-img" src="${archivo}" onclick="zoomQR('${id}')">
<div class="botones-qr">
<button class="btn-copy" onclick="copiarQR('${id}')">üìã Copiar</button>
<button class="btn-download" onclick="descargarQR('${archivo}','${nombre}')">‚¨á Descargar</button>
</div>
</div>
`;
});

html+=`</div></div>`;
}

contenedor.innerHTML=html;

}catch{
contenedor.innerHTML="<p style='color:red'>Error cargando galer√≠a</p>";
}
}


function filtrarMensajes(){

// üî• SCROLL AUTOM√ÅTICO AL BUSCAR
window.scrollTo({
top: document.getElementById("mensajesPanel").offsetTop - 20,
behavior: "smooth"
});

let input=document.getElementById("buscadorMensajes").value.toLowerCase();

// üîπ SI EST√Å VAC√çO ‚Üí VOLVER AL ESTADO ORIGINAL
if(input.trim()===""){

// Mostrar todas las tarjetas
document.querySelectorAll("#listaMensajes .card-pro").forEach(card=>{
card.style.display="block";
});

// Mostrar todas las categor√≠as
document.querySelectorAll("#listaMensajes .categoria").forEach(cat=>{
cat.style.display="block";

// Cerrar todas las categor√≠as
let contenido=cat.querySelector(".contenido");
contenido.classList.remove("abierto");
contenido.style.maxHeight="0px";
});

return;
}


// üîπ FILTRAR TARJETAS
document.querySelectorAll("#listaMensajes .card-pro").forEach(card=>{

let texto=card.innerText.toLowerCase();

if(texto.includes(input)){
card.style.display="block";
}else{
card.style.display="none";
}

});


// üîπ OCULTAR CATEGOR√çAS VAC√çAS Y ABRIR LAS QUE TENGAN RESULTADOS
document.querySelectorAll("#listaMensajes .categoria").forEach(cat=>{

let tarjetas=cat.querySelectorAll(".card-pro");
let algunaVisible=false;

tarjetas.forEach(t=>{
if(t.style.display!=="none"){
algunaVisible=true;
}
});

if(algunaVisible){

cat.style.display="block";

let contenido=cat.querySelector(".contenido");
contenido.classList.add("abierto");
contenido.style.maxHeight=contenido.scrollHeight+"px";

}else{

cat.style.display="none";

}

});

}
  
function filtrarMensajes(){

// üî• SCROLL AUTOM√ÅTICO AL BUSCAR
window.scrollTo({
top: document.getElementById("mensajesPanel").offsetTop - 20,
behavior: "smooth"
});

let input=document.getElementById("buscadorMensajes").value.toLowerCase();

// üîπ SI EST√Å VAC√çO ‚Üí VOLVER AL ESTADO ORIGINAL
if(input.trim()===""){

// Mostrar todas las tarjetas
document.querySelectorAll("#listaMensajes .card-pro").forEach(card=>{
card.style.display="block";
});

// Mostrar todas las categor√≠as
document.querySelectorAll("#listaMensajes .categoria").forEach(cat=>{
cat.style.display="block";

// Cerrar todas las categor√≠as
let contenido=cat.querySelector(".contenido");
contenido.classList.remove("abierto");
contenido.style.maxHeight="0px";
});

return;
}


// üîπ FILTRAR TARJETAS
document.querySelectorAll("#listaMensajes .card-pro").forEach(card=>{

let texto=card.innerText.toLowerCase();

if(texto.includes(input)){
card.style.display="block";
}else{
card.style.display="none";
}

});


// üîπ OCULTAR CATEGOR√çAS VAC√çAS Y ABRIR LAS QUE TENGAN RESULTADOS
document.querySelectorAll("#listaMensajes .categoria").forEach(cat=>{

let tarjetas=cat.querySelectorAll(".card-pro");
let algunaVisible=false;

tarjetas.forEach(t=>{
if(t.style.display!=="none"){
algunaVisible=true;
}
});

if(algunaVisible){

cat.style.display="block";

let contenido=cat.querySelector(".contenido");
contenido.classList.add("abierto");
contenido.style.maxHeight=contenido.scrollHeight+"px";

}else{

cat.style.display="none";

}

});

}
  
// ===== UTIL =====

function copiarBloque(event,texto){
event.stopPropagation();
navigator.clipboard.writeText(texto);
mostrarMensaje("‚úÖ Copiado");
}

function mostrarMensaje(msg){
let aviso=document.createElement("div");
aviso.innerText=msg;
aviso.className="toast";
document.body.appendChild(aviso);
setTimeout(()=>aviso.remove(),1800);
}

async function copiarQR(idImg){
let img=document.getElementById(idImg);
try{
const response=await fetch(img.src);
const blob=await response.blob();
await navigator.clipboard.write([
new ClipboardItem({[blob.type]:blob})
]);
mostrarMensaje("‚úÖ Imagen copiada");
}catch{
mostrarMensaje("‚ùå No se pudo copiar");
}
}

function descargarQR(archivo,nombre){
let a=document.createElement("a");
a.href=archivo;
a.download=nombre+".png";
a.click();
}

function zoomQR(id){
document.getElementById(id).classList.toggle("zoom");
}

function logout(){
localStorage.clear();
window.location.href="login.html";
}
  
</script>

</body>
</html>  
